<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Servicios de Clientes</title>
    <style>
        /* ESTILOS CSS */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        h1 { color: #0056b3; }
        h2 { color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-top: 30px; }
        .tab-nav { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-button { background-color: #f1f1f1; border: none; padding: 12px 20px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s, color 0.3s; border-top-left-radius: 5px; border-top-right-radius: 5px; margin-right: 5px; }
        .tab-button:hover { background-color: #ddd; }
        .tab-button.active { background-color: #0056b3; color: white; border-bottom: 2px solid #0056b3; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #add-job-form { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        #add-job-form input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; flex-grow: 1; }
        #add-job-form button { padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s; }
        #add-job-form button:hover { background-color: #218838; }
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        thead { background-color: #f8f9fa; }
        tbody tr:nth-of-type(even) { background-color: #f8f9fa; }
        tbody tr:hover { background-color: #e9ecef; }
        .status { padding: 5px 10px; border-radius: 15px; font-size: 14px; font-weight: bold; text-align: center; color: white; }
        .status.pagado { background-color: #28a745; }
        .status.pendiente { background-color: #ffc107; color: #333; }
        .status.suspendido { background-color: #dc3545; }
        .action-btn { margin-right: 5px; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; color: white; }
        .action-btn.pay { background-color: #007bff; }
        .action-btn.suspend { background-color: #fd7e14; }
        .action-btn.delete { background-color: #dc3545; }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background-color: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 5px solid #0056b3; }
        .card h3 { margin: 0 0 10px 0; font-size: 18px; color: #555; }
        .card p { font-size: 24px; font-weight: bold; color: #0056b3; margin: 0; }
        .settings-group { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .settings-group label { display: block; margin-bottom: 15px; font-size: 16px; cursor: pointer; }
        .settings-group input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; margin-bottom: 10px; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        .import-section { margin-top: 15px; }
        #notification-status { font-style: italic; color: #666; }
    </style>
</head>
<body>

    <div class="container">
        <header><h1>üõ†Ô∏è Control de Servicios de Clientes</h1></header>
        <nav class="tab-nav">
            <button class="tab-button active" data-tab="control-panel">Control</button>
            <button class="tab-button" data-tab="reports-panel">Reportes</button>
            <button class="tab-button" data-tab="backup-panel">Backup y Ajustes</button>
        </nav>
        <main>
            <section id="control-panel" class="tab-content active">
                <h2>A√±adir Nuevo Servicio</h2>
                <form id="add-job-form">
                    <input type="text" id="client-name" placeholder="Nombre del Cliente" required>
                    <input type="number" id="total-price" placeholder="Precio Total del Servicio" step="0.01" min="0" required>
                    <button type="submit">A√±adir Servicio</button>
                </form>
                <h2>Servicios del D√≠a</h2>
                <div class="table-wrapper">
                    <table id="jobs-table"><thead><tr><th>Cliente</th><th>Precio Total</th><th>Estado</th><th>Acciones</th></tr></thead><tbody></tbody></table>
                </div>
            </section>
            <section id="reports-panel" class="tab-content">
                <h2>Resumen General</h2>
                <div class="summary-cards">
                    <div class="card"><h3>Total Cobrado Hoy</h3><p id="total-paid">0.00</p></div>
                    <div class="card"><h3>Total Por Cobrar</h3><p id="total-owed">0.00</p></div>
                    <div class="card"><h3>Clientes Pendientes</h3><p id="count-pending">0</p></div>
                    <div class="card"><h3>Clientes Suspendidos</h3><p id="count-suspended">0</p></div>
                </div>
                <h2>Detalle de Deudores</h2>
                <div class="table-wrapper">
                    <table id="debtors-table"><thead><tr><th>Cliente</th><th>Deuda Total</th></tr></thead><tbody></tbody></table>
                </div>
            </section>
            <section id="backup-panel" class="tab-content">
                <h2>Configuraci√≥n de Backup</h2>
                <div class="settings-group">
                    <label><input type="checkbox" id="auto-backup-toggle"> Habilitar Backup Autom√°tico (8:00 AM)</label>
                    <button id="request-notifications-btn">Habilitar Notificaciones de Escritorio</button>
                    <p id="notification-status">Estado de las notificaciones: No solicitado.</p>
                </div>
                <h2>Backup Manual</h2>
                <div class="settings-group">
                    <button id="manual-backup-btn">üîΩ Exportar / Descargar Datos</button>
                    <div class="import-section">
                        <label for="load-backup-input">üîº Cargar un Backup (archivo .json):</label>
                        <input type="file" id="load-backup-input" accept=".json">
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // C√ìDIGO JAVASCRIPT
        document.addEventListener('DOMContentLoaded', () => {
            const DB_NAME = 'serviceControlData', SETTINGS_NAME = 'serviceControlSettings', LAST_BACKUP_DATE_KEY = 'lastBackupDate', LAST_REMINDER_DATE_KEY = 'lastReminderDate';
            let jobs = [], settings = { autoBackupEnabled: false, notificationPermission: 'default' };
            const tabButtons = document.querySelectorAll('.tab-button'), tabContents = document.querySelectorAll('.tab-content'), addJobForm = document.getElementById('add-job-form'), jobsTableBody = document.querySelector('#jobs-table tbody'), manualBackupBtn = document.getElementById('manual-backup-btn'), loadBackupInput = document.getElementById('load-backup-input'), autoBackupToggle = document.getElementById('auto-backup-toggle'), requestNotificationsBtn = document.getElementById('request-notifications-btn'), notificationStatusEl = document.getElementById('notification-status');
            function loadData() { const savedJobs = localStorage.getItem(DB_NAME), savedSettings = localStorage.getItem(SETTINGS_NAME); if (savedJobs) jobs = JSON.parse(savedJobs); if (savedSettings) { settings = JSON.parse(savedSettings); autoBackupToggle.checked = settings.autoBackupEnabled; updateNotificationStatus(); } }
            function saveData() { localStorage.setItem(DB_NAME, JSON.stringify(jobs)); localStorage.setItem(SETTINGS_NAME, JSON.stringify(settings)); }
            function renderTable() { jobsTableBody.innerHTML = ''; jobs.forEach(job => { const row = document.createElement('tr'); row.innerHTML = `<td>${job.clientName}</td><td>${job.total.toFixed(2)}</td><td><span class="status ${job.status}">${job.status.charAt(0).toUpperCase() + job.status.slice(1)}</span></td><td>${job.status !== 'pagado' ? `<button class="action-btn pay" data-id="${job.id}" data-action="mark-paid">Pagar</button>` : ''}${job.status !== 'suspendido' ? `<button class="action-btn suspend" data-id="${job.id}" data-action="suspend">Suspender</button>` : ''}<button class="action-btn delete" data-id="${job.id}" data-action="delete">Eliminar</button></td>`; jobsTableBody.appendChild(row); }); renderReports(); }
            function renderReports() { const totalPaidEl = document.getElementById('total-paid'), totalOwedEl = document.getElementById('total-owed'), countPendingEl = document.getElementById('count-pending'), countSuspendedEl = document.getElementById('count-suspended'), debtorsTableBody = document.querySelector('#debtors-table tbody'); let totalPaid = 0, totalOwed = 0, pendingCount = 0, suspendedCount = 0, debtors = {}; jobs.forEach(job => { if (job.status === 'pagado') totalPaid += job.total; else { totalOwed += job.total; if (job.status === 'pendiente') pendingCount++; else if (job.status === 'suspendido') suspendedCount++; debtors[job.clientName] = (debtors[job.clientName] || 0) + job.total; } }); totalPaidEl.textContent = totalPaid.toFixed(2); totalOwedEl.textContent = totalOwed.toFixed(2); countPendingEl.textContent = pendingCount; countSuspendedEl.textContent = suspendedCount; debtorsTableBody.innerHTML = ''; for (const client in debtors) { const row = document.createElement('tr'); row.innerHTML = `<td>${client}</td><td>${debtors[client].toFixed(2)}</td>`; debtorsTableBody.appendChild(row); } }
            tabButtons.forEach(button => { button.addEventListener('click', () => { const targetTab = button.dataset.tab; tabButtons.forEach(btn => btn.classList.remove('active')); tabContents.forEach(content => content.classList.remove('active')); button.classList.add('active'); document.getElementById(targetTab).classList.add('active'); }); });
            addJobForm.addEventListener('submit', (e) => { e.preventDefault(); const clientName = document.getElementById('client-name').value.trim(), totalPrice = parseFloat(document.getElementById('total-price').value); if (!clientName || isNaN(totalPrice)) { alert('Por favor, completa todos los campos correctamente.'); return; } jobs.push({ id: Date.now().toString(), clientName, total: totalPrice, status: 'pendiente', date: new Date().toISOString() }); saveData(); renderTable(); addJobForm.reset(); });
            jobsTableBody.addEventListener('click', (e) => { if (e.target.classList.contains('action-btn')) { const id = e.target.dataset.id, action = e.target.dataset.action, job = jobs.find(j => j.id === id); if (!job) return; if (action === 'mark-paid') job.status = 'pagado'; else if (action === 'suspend') job.status = 'suspendido'; else if (action === 'delete' && confirm(`¬øEst√°s seguro de que quieres eliminar el servicio de ${job.clientName}?`)) jobs = jobs.filter(j => j.id !== id); saveData(); renderTable(); } });
            function exportData() { const dataStr = JSON.stringify(jobs, null, 2), dataBlob = new Blob([dataStr], { type: 'application/json' }), url = URL.createObjectURL(dataBlob), link = document.createElement('a'); link.href = url; link.download = `backup_servicios_${new Date().toISOString().slice(0, 10)}.json`; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); showNotification('Backup Exportado', 'Los datos han sido descargados correctamente.'); }
            function importData(event) { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const importedJobs = JSON.parse(e.target.result); if (Array.isArray(importedJobs) && confirm('¬øEst√°s seguro? Esto reemplazar√° todos tus datos actuales.')) { jobs = importedJobs; saveData(); renderTable(); showNotification('Backup Cargado', 'Los datos han sido importados correctamente.'); } else alert('El archivo no es un backup v√°lido.'); } catch (error) { alert('Error al leer el archivo. Aseg√∫rate de que es un archivo .json v√°lido.'); } }; reader.readAsText(file); event.target.value = ''; }
            manualBackupBtn.addEventListener('click', exportData); loadBackupInput.addEventListener('change', importData);
            function updateNotificationStatus() { notificationStatusEl.textContent = `Estado de las notificaciones: ${settings.notificationPermission === 'granted' ? 'Habilitadas' : 'Deshabilitadas'}`; }
            requestNotificationsBtn.addEventListener('click', async () => { if ('Notification' in window) { const permission = await Notification.requestPermission(); settings.notificationPermission = permission; saveData(); updateNotificationStatus(); if (permission === 'granted') showNotification('Notificaciones Activadas', 'Ahora recibir√°s recordatorios de backup.'); } else alert('Tu navegador no soporta notificaciones de escritorio.'); });
            function showNotification(title, body) { if (settings.notificationPermission === 'granted') new Notification(title, { body: body, icon: 'https://i.imgur.com/r9SbqJp.png' }); }
            function checkAndPerformScheduledTasks() { if (!settings.autoBackupEnabled) return; const now = new Date(), todayStr = now.toISOString().slice(0, 10), lastBackupDate = localStorage.getItem(LAST_BACKUP_DATE_KEY), lastReminderDate = localStorage.getItem(LAST_REMINDER_DATE_KEY); if (now.getHours() >= 8 && lastBackupDate !== todayStr) { console.log("Realizando backup autom√°tico..."); exportData(); localStorage.setItem(LAST_BACKUP_DATE_KEY, todayStr); } if (now.getHours() >= 9 && lastBackupDate !== todayStr && lastReminderDate !== todayStr) { console.log("Enviando recordatorio de backup..."); showNotification('Recordatorio de Backup', 'No se ha realizado el backup autom√°tico de hoy. Hazlo manualmente para evitar la p√©rdida de datos.'); localStorage.setItem(LAST_REMINDER_DATE_KEY, todayStr); } }
            autoBackupToggle.addEventListener('change', (e) => { settings.autoBackupEnabled = e.target.checked; saveData(); if (settings.autoBackupEnabled) checkAndPerformScheduledTasks(); });
            loadData(); renderTable(); setInterval(checkAndPerformScheduledTasks, 300000); checkAndPerformScheduledTasks();
        });
    </script>
</body>

</html>
